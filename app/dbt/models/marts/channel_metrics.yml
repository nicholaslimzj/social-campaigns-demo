version: 2

models:
  - name: channel_metrics
    description: "Aggregates key campaign performance metrics from `stg_campaigns` grouped by the marketing channel used. Provides a channel-level view of campaign effectiveness, including counts, rates, costs, and engagement totals."
    config:
      materialized: table
      tags: ['mart', 'marketing', 'performance'] # Added 'marketing' and 'performance' for better categorization

    columns:
      - name: Channel_Used
        description: "The marketing channel used for the campaigns (e.g., Facebook, Instagram, Pinterest, Twitter). This acts as the primary key for this aggregated table."
        data_type: VARCHAR
        tests:
          - not_null:
              description: "Channel name must exist for every aggregated record."
          - unique:
              description: "Each channel should have only one summary row in this table."
          # Optional: Add accepted_values if the list of channels is known and fixed.
          # - accepted_values:
          #     values: ['Pinterest', 'Instagram', 'Twitter', 'Facebook'] # Example

      - name: campaign_count
        description: "The total number of campaigns run on this channel."
        data_type: BIGINT
        tests:
          - not_null:
              description: "Campaign count must be calculated for each channel."
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: BIGINT
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
              # No max_value needed unless there's a known upper limit
              description: "Campaign count cannot be negative."
              # Using dbt_expectations for more specific range check, fallback to standard test:
          # - accepted_range:
          #     min: 0

      - name: avg_conversion_rate
        description: "The average conversion rate across all campaigns for this channel, expressed as a decimal (e.g., 0.08 means 8%)."
        data_type: DOUBLE
        tests:
          - not_null:
              description: "Average conversion rate must be calculated."
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: DOUBLE
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
              # max_value: 1 # Optional: Only if conversion rate is strictly <= 100%
              description: "Average conversion rate should generally be non-negative."
              # Fallback standard test:
          # - accepted_range:
          #     min: 0
          #     # max: 1 # Optional

      - name: avg_roi
        description: "The average Return on Investment (ROI) across all campaigns for this channel. Can be positive or negative."
        data_type: DOUBLE
        tests:
          - not_null:
              description: "Average ROI must be calculated."
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: DOUBLE

      - name: avg_acquisition_cost
        description: "The average cost to acquire a customer (or achieve the campaign goal) across all campaigns for this channel."
        data_type: DOUBLE
        tests:
          - not_null:
              description: "Average acquisition cost must be calculated."
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: DOUBLE
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
              description: "Average acquisition cost cannot be negative."
              # Fallback standard test:
          # - accepted_range:
          #     min: 0

      - name: total_clicks
        description: "The total number of clicks generated by all campaigns on this channel."
        data_type: HUGEINT
        tests:
          - not_null:
              description: "Total clicks must be calculated."
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: HUGEINT
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
              description: "Total clicks cannot be negative."
              # Fallback standard test:
          # - accepted_range:
          #     min: 0

      - name: total_impressions
        description: "The total number of impressions generated by all campaigns on this channel."
        data_type: HUGEINT
        tests:
          - not_null:
              description: "Total impressions must be calculated."
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: HUGEINT
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
              description: "Total impressions cannot be negative."
              # Fallback standard test:
          # - accepted_range:
          #     min: 0

      - name: overall_ctr
        description: "The overall Click-Through Rate (CTR) for this channel (Total Clicks / Total Impressions), expressed as a decimal."
        data_type: FLOAT # Note: Sample data shows FLOAT, SQL might produce DOUBLE depending on DB
        tests:
          - not_null:
              description: "Overall CTR must be calculated."
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: FLOAT # Adjust if actual type is DOUBLE
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
              # max_value: 1 # Optional: Only if CTR is strictly <= 100%
              description: "Overall CTR should generally be non-negative."
              # Fallback standard test:
          # - accepted_range:
          #     min: 0
          #     # max: 1 # Optional