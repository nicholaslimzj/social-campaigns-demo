version: 2

models:
  - name: channel_historical_metrics
    description: "Aggregates historical campaign performance metrics by marketing channel. Provides insights for channel effectiveness comparison, ROI analysis, and media mix optimization. Used in Channel Performance dashboards, Media Mix recommendations, and ROI comparison visualizations."
    config:
      materialized: table
      tags: ['mart', 'marketing', 'performance']
    columns:
      - name: Channel_Used
        description: "The marketing channel used for the campaigns (e.g., Facebook, Pinterest, Instagram, Twitter). This serves as the primary key for this aggregated model."
        tests:
          - not_null
          - unique
          # Ensures that every channel listed here exists in the staging campaigns data
          - relationships:
              to: ref('stg_campaigns')
              field: Channel_Used

      - name: campaign_count
        description: "The total number of distinct campaigns run on this channel across all historical data."
        tests:
          - not_null
          # Campaign count should be zero or positive
          - dbt_expectations.expect_column_values_to_be_greater_than_or_equal_to:
              min_value: 0

      - name: avg_conversion_rate
        description: "The average conversion rate across all campaigns for this channel. Represents the average efficiency of campaigns in achieving their conversion goals on this channel."
        tests:
          - not_null
          # Conversion rate should typically be between 0 and 1 (or 0% and 100%)
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
              max_value: 1 # Assuming rate is expressed as a decimal (e.g., 0.08 for 8%)

      - name: avg_roi
        description: "The average Return on Investment (ROI) across all campaigns for this channel. Indicates the average profitability of marketing spend on this channel."
        tests:
          - not_null
          # ROI can be negative, so no non-negative constraint is applied by default.

      - name: avg_acquisition_cost
        description: "The average cost to acquire a customer or achieve a conversion (CPA/CAC) across all campaigns for this channel."
        tests:
          - not_null
          # Acquisition cost should generally be non-negative
          - dbt_expectations.expect_column_values_to_be_greater_than_or_equal_to:
              min_value: 0

      - name: total_clicks
        description: "The total number of clicks accumulated across all campaigns attributed to this channel."
        tests:
          - not_null
          # Clicks cannot be negative
          - dbt_expectations.expect_column_values_to_be_greater_than_or_equal_to:
              min_value: 0

      - name: total_impressions
        description: "The total number of impressions (ad views) accumulated across all campaigns attributed to this channel."
        tests:
          - not_null
          # Impressions cannot be negative
          - dbt_expectations.expect_column_values_to_be_greater_than_or_equal_to:
              min_value: 0

      - name: overall_ctr
        description: "The overall Click-Through Rate (CTR) for this channel, calculated as Total Clicks / Total Impressions across all campaigns. Measures the overall effectiveness of ad creatives and targeting on this channel."
        tests:
          - not_null
          # CTR should be between 0 and 1 (or 0% and 100%)
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
              max_value: 1 # Assuming rate is expressed as a decimal