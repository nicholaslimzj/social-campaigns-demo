{
  "name": "channel_quarter_anomalies",
  "description": "Identifies anomalies in marketing channel performance on a quarterly basis. Compares key metrics (Conversion Rate, ROI, Acquisition Cost, Clicks, Impressions, CTR, Spend, Revenue) for the latest quarter against a rolling 3-quarter average using z-score methodology. Flags significant deviations (>2 standard deviations) to highlight potential issues or successes. Designed for performance monitoring and risk management dashboards.",
  "columns": [
    {
      "name": "Channel_Used",
      "type": "VARCHAR",
      "description": "The marketing channel being analyzed (e.g., Facebook, Instagram, Google Ads).",
      "tests": [
        "not_null",
        "dbt_utils.unique_combination_of_columns"
      ],
      "tags": []
    },
    {
      "name": "quarter",
      "type": "DOUBLE",
      "description": "A numerical representation of the year and quarter (calculated as YYYY * 4 + CEIL(Month / 3)). Represents the time period for the aggregated metrics.",
      "tests": [
        "not_null"
      ],
      "tags": []
    },
    {
      "name": "avg_conversion_rate",
      "type": "DOUBLE",
      "description": "The average conversion rate for the channel during the specified quarter.",
      "tests": [],
      "tags": []
    },
    {
      "name": "conversion_rate_mean",
      "type": "DOUBLE",
      "description": "The rolling average of the conversion rate over the previous 3 quarters for the channel. Used as the expected value.",
      "tests": [],
      "tags": []
    },
    {
      "name": "conversion_rate_std",
      "type": "DOUBLE",
      "description": "The rolling standard deviation of the conversion rate over the previous 3 quarters for the channel. Used to measure variability.",
      "tests": [],
      "tags": []
    },
    {
      "name": "conversion_rate_z",
      "type": "DOUBLE",
      "description": "The z-score for conversion rate in the quarter, calculated as (value - rolling_mean) / rolling_std. Measures deviation from the recent average in terms of standard deviations.",
      "tests": [],
      "tags": []
    },
    {
      "name": "conversion_rate_anomaly",
      "type": "VARCHAR",
      "description": "Flag indicating if the conversion rate for the quarter is considered an anomaly ('anomaly' if |z-score| > 2, 'normal' otherwise).",
      "tests": [
        "not_null",
        "accepted_values"
      ],
      "tags": []
    },
    {
      "name": "avg_roi",
      "type": "DOUBLE",
      "description": "The average Return on Investment (ROI) for the channel during the specified quarter.",
      "tests": [],
      "tags": []
    },
    {
      "name": "roi_mean",
      "type": "DOUBLE",
      "description": "The rolling average of the ROI over the previous 3 quarters for the channel.",
      "tests": [],
      "tags": []
    },
    {
      "name": "roi_std",
      "type": "DOUBLE",
      "description": "The rolling standard deviation of the ROI over the previous 3 quarters for the channel.",
      "tests": [],
      "tags": []
    },
    {
      "name": "roi_z",
      "type": "DOUBLE",
      "description": "The z-score for ROI in the quarter.",
      "tests": [],
      "tags": []
    },
    {
      "name": "roi_anomaly",
      "type": "VARCHAR",
      "description": "Flag indicating if the ROI for the quarter is considered an anomaly.",
      "tests": [
        "not_null",
        "accepted_values"
      ],
      "tags": []
    },
    {
      "name": "avg_acquisition_cost",
      "type": "DOUBLE",
      "description": "The average acquisition cost for the channel during the specified quarter.",
      "tests": [],
      "tags": []
    },
    {
      "name": "acquisition_cost_mean",
      "type": "DOUBLE",
      "description": "The rolling average of the acquisition cost over the previous 3 quarters for the channel.",
      "tests": [],
      "tags": []
    },
    {
      "name": "acquisition_cost_std",
      "type": "DOUBLE",
      "description": "The rolling standard deviation of the acquisition cost over the previous 3 quarters for the channel.",
      "tests": [],
      "tags": []
    },
    {
      "name": "acquisition_cost_z",
      "type": "DOUBLE",
      "description": "The z-score for acquisition cost in the quarter.",
      "tests": [],
      "tags": []
    },
    {
      "name": "acquisition_cost_anomaly",
      "type": "VARCHAR",
      "description": "Flag indicating if the acquisition cost for the quarter is considered an anomaly.",
      "tests": [
        "not_null",
        "accepted_values"
      ],
      "tags": []
    },
    {
      "name": "total_clicks",
      "type": "HUGEINT",
      "description": "The total number of clicks generated by the channel during the specified quarter.",
      "tests": [
        "not_null"
      ],
      "tags": []
    },
    {
      "name": "clicks_mean",
      "type": "DOUBLE",
      "description": "The rolling average of total clicks over the previous 3 quarters for the channel.",
      "tests": [],
      "tags": []
    },
    {
      "name": "clicks_std",
      "type": "DOUBLE",
      "description": "The rolling standard deviation of total clicks over the previous 3 quarters for the channel.",
      "tests": [],
      "tags": []
    },
    {
      "name": "clicks_z",
      "type": "DOUBLE",
      "description": "The z-score for total clicks in the quarter.",
      "tests": [],
      "tags": []
    },
    {
      "name": "clicks_anomaly",
      "type": "VARCHAR",
      "description": "Flag indicating if the total clicks for the quarter is considered an anomaly.",
      "tests": [
        "not_null",
        "accepted_values"
      ],
      "tags": []
    },
    {
      "name": "total_impressions",
      "type": "HUGEINT",
      "description": "The total number of impressions generated by the channel during the specified quarter.",
      "tests": [
        "not_null"
      ],
      "tags": []
    },
    {
      "name": "impressions_mean",
      "type": "DOUBLE",
      "description": "The rolling average of total impressions over the previous 3 quarters for the channel.",
      "tests": [],
      "tags": []
    },
    {
      "name": "impressions_std",
      "type": "DOUBLE",
      "description": "The rolling standard deviation of total impressions over the previous 3 quarters for the channel.",
      "tests": [],
      "tags": []
    },
    {
      "name": "impressions_z",
      "type": "DOUBLE",
      "description": "The z-score for total impressions in the quarter.",
      "tests": [],
      "tags": []
    },
    {
      "name": "impressions_anomaly",
      "type": "VARCHAR",
      "description": "Flag indicating if the total impressions for the quarter is considered an anomaly.",
      "tests": [
        "not_null",
        "accepted_values"
      ],
      "tags": []
    },
    {
      "name": "quarterly_ctr",
      "type": "FLOAT",
      "description": "The calculated Click-Through Rate (CTR) for the channel during the specified quarter (Total Clicks / Total Impressions).",
      "tests": [],
      "tags": []
    },
    {
      "name": "ctr_mean",
      "type": "DOUBLE",
      "description": "The rolling average of the quarterly CTR over the previous 3 quarters for the channel.",
      "tests": [],
      "tags": []
    },
    {
      "name": "ctr_std",
      "type": "DOUBLE",
      "description": "The rolling standard deviation of the quarterly CTR over the previous 3 quarters for the channel.",
      "tests": [],
      "tags": []
    },
    {
      "name": "ctr_z",
      "type": "DOUBLE",
      "description": "The z-score for quarterly CTR in the quarter.",
      "tests": [],
      "tags": []
    },
    {
      "name": "ctr_anomaly",
      "type": "VARCHAR",
      "description": "Flag indicating if the quarterly CTR for the quarter is considered an anomaly.",
      "tests": [
        "not_null",
        "accepted_values"
      ],
      "tags": []
    },
    {
      "name": "total_spend",
      "type": "DOUBLE",
      "description": "The total calculated spend for the channel during the specified quarter (SUM of Clicks * Acquisition_Cost).",
      "tests": [
        "not_null"
      ],
      "tags": []
    },
    {
      "name": "spend_mean",
      "type": "DOUBLE",
      "description": "The rolling average of total spend over the previous 3 quarters for the channel.",
      "tests": [],
      "tags": []
    },
    {
      "name": "spend_std",
      "type": "DOUBLE",
      "description": "The rolling standard deviation of total spend over the previous 3 quarters for the channel.",
      "tests": [],
      "tags": []
    },
    {
      "name": "spend_z",
      "type": "DOUBLE",
      "description": "The z-score for total spend in the quarter.",
      "tests": [],
      "tags": []
    },
    {
      "name": "spend_anomaly",
      "type": "VARCHAR",
      "description": "Flag indicating if the total spend for the quarter is considered an anomaly.",
      "tests": [
        "not_null",
        "accepted_values"
      ],
      "tags": []
    },
    {
      "name": "total_revenue",
      "type": "DOUBLE",
      "description": "The total calculated revenue for the channel during the specified quarter (SUM of Clicks * Acquisition_Cost * ROI).",
      "tests": [
        "not_null"
      ],
      "tags": []
    },
    {
      "name": "revenue_mean",
      "type": "DOUBLE",
      "description": "The rolling average of total revenue over the previous 3 quarters for the channel.",
      "tests": [],
      "tags": []
    },
    {
      "name": "revenue_std",
      "type": "DOUBLE",
      "description": "The rolling standard deviation of total revenue over the previous 3 quarters for the channel.",
      "tests": [],
      "tags": []
    },
    {
      "name": "revenue_z",
      "type": "DOUBLE",
      "description": "The z-score for total revenue in the quarter.",
      "tests": [],
      "tags": []
    },
    {
      "name": "revenue_anomaly",
      "type": "VARCHAR",
      "description": "Flag indicating if the total revenue for the quarter is considered an anomaly.",
      "tests": [
        "not_null",
        "accepted_values"
      ],
      "tags": []
    },
    {
      "name": "has_anomaly",
      "type": "BOOLEAN",
      "description": "Boolean flag (TRUE/FALSE) indicating if *any* metric for this channel and quarter was flagged as an anomaly.",
      "tests": [
        "not_null"
      ],
      "tags": []
    },
    {
      "name": "anomaly_count",
      "type": "INTEGER",
      "description": "The total number of individual metrics flagged as anomalies for this channel and quarter.",
      "tests": [
        "not_null",
        "dbt_expectations.expect_column_values_to_be_between"
      ],
      "tags": []
    },
    {
      "name": "anomaly_impact",
      "type": "VARCHAR",
      "description": "Overall assessment of the anomaly's direction ('positive' if driven by favorable deviations, 'negative' if driven by unfavorable deviations, 'normal' if no significant anomalies).",
      "tests": [
        "not_null",
        "accepted_values"
      ],
      "tags": []
    }
  ],
  "tags": []
}