{
  "name": "metrics_monthly_trends",
  "description": "Mart model that analyzes monthly performance trends for key metrics (Conversion Rate, ROI, Acquisition Cost, CTR) per company. It calculates 3-month moving averages and identifies significant trend changes (upward, downward, or stable) compared to previous periods. This model is designed to support trend-based decision making and populate performance dashboards, specifically focusing on trend analysis, performance change alerts, and month-over-month comparisons.",
  "columns": [
    {
      "name": "Company",
      "type": "VARCHAR",
      "description": "The unique identifier for the company whose metrics are being analyzed.",
      "tests": [
        "not_null",
        "relationships",
        "dbt_utils.unique_combination_of_columns"
      ],
      "tags": []
    },
    {
      "name": "month",
      "type": "BIGINT",
      "description": "The numerical representation of the month (1-12) for which the metrics are calculated. Note: Only includes months >= 4 due to the 3-month moving average calculation requirement.",
      "tests": [
        "not_null",
        "accepted_values"
      ],
      "tags": []
    },
    {
      "name": "avg_conversion_rate",
      "type": "DOUBLE",
      "description": "The average conversion rate for the company during the specified month.",
      "tests": [
        "not_null",
        "dbt_utils.expression_is_true"
      ],
      "tags": []
    },
    {
      "name": "conversion_rate_ma",
      "type": "DOUBLE",
      "description": "The 3-month moving average of the conversion rate, calculated using the current month and the two preceding months. Smooths out short-term fluctuations to reveal underlying trends.",
      "tests": [
        "not_null",
        "dbt_utils.expression_is_true"
      ],
      "tags": []
    },
    {
      "name": "prev_conversion_rate_ma",
      "type": "DOUBLE",
      "description": "The 3-month moving average of the conversion rate from three months prior to the current month. Used as a baseline for detecting significant trend changes.",
      "tests": [
        "not_null",
        "dbt_utils.expression_is_true"
      ],
      "tags": []
    },
    {
      "name": "conversion_rate_trend_change",
      "type": "INTEGER",
      "description": "Indicator of significant change in the conversion rate trend compared to 3 months prior. Values: 1 (Upward change), -1 (Downward change), 0 (No significant change or insufficient history).",
      "tests": [
        "not_null",
        "accepted_values"
      ],
      "tags": []
    },
    {
      "name": "roi_trend_change",
      "type": "INTEGER",
      "description": "Indicator of significant change in the Return on Investment (ROI) trend compared to 3 months prior. Values: 1 (Upward change), -1 (Downward change), 0 (No significant change or insufficient history).",
      "tests": [
        "not_null",
        "accepted_values"
      ],
      "tags": []
    },
    {
      "name": "acquisition_cost_trend_change",
      "type": "INTEGER",
      "description": "Indicator of significant change in the Acquisition Cost trend compared to 3 months prior. Note: Lower cost is better. Values: 1 (Downward change - improvement), -1 (Upward change - worsening), 0 (No significant change or insufficient history).",
      "tests": [
        "not_null",
        "accepted_values"
      ],
      "tags": []
    },
    {
      "name": "ctr_trend_change",
      "type": "INTEGER",
      "description": "Indicator of significant change in the Click-Through Rate (CTR) trend compared to 3 months prior. Values: 1 (Upward change), -1 (Downward change), 0 (No significant change or insufficient history).",
      "tests": [
        "not_null",
        "accepted_values"
      ],
      "tags": []
    },
    {
      "name": "has_trend_change",
      "type": "BOOLEAN",
      "description": "Boolean flag (TRUE/FALSE) indicating if there was a significant trend change detected in *any* of the key metrics (Conversion Rate, ROI, Acquisition Cost, CTR) for the month compared to 3 months prior.",
      "tests": [
        "not_null"
      ],
      "tags": []
    }
  ],
  "tags": []
}